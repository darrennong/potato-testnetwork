# 超级节点安全审计方案

## 目录

- [审计核心目标](#审计核心目标)
- [审计的核心方向](#审计的核心方向)
- [审计内容](#审计内容)
  - [1. 节点自我审计](#1-节点自我审计)
    - [1.1 架构审计](#11-架构审计)
    - [1.2 RPC 安全审计](#12-rpc-安全审计)
    - [1.3 安全配置审计](#13-安全配置审计)
  - [2. 安全团队审计](#2-安全团队审计)
    - [2.1 基础设施审计](#21-基础设施审计)
    - [2.2 节点脆弱性审计](#22-节点脆弱性审计)
    - [2.3 抗 DDoS 能力审计](#23-抗-ddos-能力审计)

## 审计核心目标

1. 审计超级节点在公网暴露服务的安全状况，查找传统安全中的常见安全问题
1. 审计超级节点架构的抗 DDoS 能力
1. 针对 POTATO 特性，进行定制化载荷攻击测试，检测整体框架壮硕性

## 审计的核心方向

1. 查找可造成整个节点停止出块的漏洞问题
1. 架构缺陷造成的单点阻塞攻击就能导致节点瘫痪的问题
1. 服务错误配置导致服务器可被远程攻击及控制的问题
1. 节点敏感信息泄露（特别是服务器 SSH 连接私钥在 GitHub 上泄漏）等问题

## 审计内容

审计以节点自我审计为主（许多敏感的服务器与操作不应该直接暴露给第三方，需要依赖节点自我审计），安全团队提供职业的指导与协作配合，这样达到最高效及最全面的效果。

### 1. 节点自我审计

参考：[POTATO 超级节点安全执行指南](./超级节点安全执行指南.md)

#### 1.1 架构审计

1. BP 服务器是否达到与外网的充分隔离，保证若有外网恶意攻击不会直接影响 BP 服务器出块
1. BP 是否多链路设计，防止出现单点故障（或针对单点的 DDoS ）导致 BP 无法与其他节点同步
1. 节点是否有必要的安全加固（如是否在一些核心通信节点外围正确的部署高防抵御 DDoS 攻击，以及适当的部署 HIDS）

#### 1.2 RPC 安全审计

1. 是否有对非必要的节点 RPC 服务进行限制
1. 若开启 RPC 服务，是否有禁用不必要的 `wallet_plugin`、`wallet_api_plugin`及`producer_api_plugin`
1. RPC 是否启用 SSL

#### 1.3 安全配置审计

1. Active 多签密钥是否配置正确
1. 是否开启日志记录，有条件下是否有开启更多安全日志记录插件等
1. max-clients 参数配置是否合理，是否易遭受 P2P 连接打满连接数，导致无法同步
1. 是否使用非 root 权限启动节点程序
1. 是否更改 SSH 服务默认端口，服务器 SSH 是否配置白名单，并且设置只允许 key（并对 key 加密）登录，禁止密码登录

### 2. 安全团队审计

#### 2.1 基础设施审计

1. 服务器提供商是否是优质的安全供应商，构建基础设施安全需要耗费巨量经费与精力，若选择一些小型服务商及可能出现服务器被攻击就被服务商主动断网的情况。所以站在巨人的肩膀上是个非常高性价比与安全的选择，经过测试目前 UCloud、AWS、Google Cloud 等拥有非常好的抗攻击与攻击后自我恢复能力。
1. 节点公网 IP 真实开放端口服务审计，防止运维人员未正确配置服务与安全规则导致脆弱点暴露。

#### 2.2 节点脆弱性审计

1. 审计节点对抗全网扫描，隐藏真实公网 IP 的能力。比如 BP 节点是否使用默认端口配置（如使用默认端口 8888、9876 这类特征端口等）导致容易被全网扫描定位，及攻击利用（目前我们已经知道有部分测试节点遭遇了 RPC 扫描与恶意调用）。
1. 审计节点敏感信息是否在公网上泄漏，如在 GitHub 上暴露等。
1. 审计 RPC 端口是否可进行恶意调用。
1. 若节点部署除 POTATO 主程序外的其他程序，则针对第三方程序进行针对性脆弱性攻防审计。
1. 审计节点是否有定制合适的应急响应方案。

#### 2.3 抗 DDoS 能力审计

1. 针对 P2P 端口的 Layer4 层的抗 UDP Flood 、TCP Flood 等（含各种主流反射型攻击）进行实战型测试。利用真实的攻击流量，来检验节点的的稳定性。
1. 针对 RPC 端口的 Layer7 层的抗 CC 攻击进行实战型测试。利用大量攻击节点高并发请求消耗服务器性能来检测节点稳定性。
